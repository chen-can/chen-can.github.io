name: Build and Deploy

# è§¦å‘æ¡ä»¶ï¼šåœ¨ push åˆ° master åˆ†æ”¯å
on: 
  # æ‰‹åŠ¨æ¨¡å¼
  # workflow_dispatch:
  # è‡ªåŠ¨æ¨¡å¼
  push:
      branches:
        - master
env: # è®¾ç½®ç¯å¢ƒå˜é‡
  TZ: Asia/Shanghai # æ—¶åŒºï¼ˆè®¾ç½®æ—¶åŒºå¯ä½¿é¡µé¢ä¸­çš„`æœ€è¿‘æ›´æ–°æ—¶é—´`ä½¿ç”¨æ—¶åŒºæ—¶é—´ï¼‰
# ä»»åŠ¡
jobs:
  build-and-deploy:
    # æœåŠ¡å™¨ç¯å¢ƒï¼šæœ€æ–°ç‰ˆ Ubuntu
    runs-on: ubuntu-latest
    steps:
      # æ‹‰å–ä»£ç 
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2.3.1 
        with:
          node-version: 14.18.0
          fetch-depth: 0
          persist-credentials: false

      # ç”Ÿæˆé™æ€æ–‡ä»¶
      - name: Install and Build ğŸ”§ 
        run:  yarn && yarn build

      # éƒ¨ç½²åˆ° GitHub Pages
      - name: Deploy ğŸš€
        uses: JamesIves/github-pages-deploy-action@3.7.1
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BRANCH: gh-pages 
          FOLDER: docs/.vitepress/dist 
      
      # éƒ¨ç½²åˆ° Gitee Pages
      - name: Sync to Gitee ğŸ’•
        uses: wearerequired/git-mirror-action@master
        env:
            # æ³¨æ„åœ¨ Settings->Secrets é…ç½® SSH_PRIVATE_KEY
            SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
        with:
            # GitHub æºä»“åº“åœ°å€
            source-repo: "git@github.com:chen-can/chen-can.github.io.git"
            # Gitee ç›®æ ‡ä»“åº“åœ°å€
            destination-repo: "git@gitee.com:chencan123/chencan123.git"

      # Gitee ä»“åº“æ›´æ–°å¹¶è‡ªåŠ¨éƒ¨ç½²     
      - name: reload
        uses: mizuka-wu/gitee-pages-action@v1.0.0
        with:
          repository: chencan123/chencan123
          cookie: ${{ secrets.GITEE_COOKIE }}
          branch: gh-pages

